<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÇRMT Station‚ñ™Ô∏èSimple Creation Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
            background: #56858A;
            min-height: 100vh;
            color: #132234;
            font-size: 11px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 8px;
        }

        .header {
            border: 2px outset #F7E0C3;
            background: #E5D0BB;
            text-align: center;
            margin-bottom: 8px;
            color: #132234;
            height: 30px;
        }

        .header h1 {
            font-size: 18px;
            margin-bottom: 4px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .header h2 {
            font-size: 11px;
            margin-top: 29px;
            margin-right: 5px;
            margin-bottom: 18px;
            font-weight: normal;
            display: flex;
            justify-content: flex-end;
        }

        /* ÂÖ®ÂüüÁãÄÊÖãÈ°ØÁ§∫ÂçÄÂüü */
        .global-status {
            margin-top: 20px;
            background: #FCEAD1;
            color: #1F3D5D;
            padding: 4px 8px;
            font-size: 11px;
            margin-bottom: 18px;
            border: 1px inset #FCEAD1;
            display: flex;
            justify-content: space-between;
        }

        /* È†ÅÈù¢Â∞éË¶ΩÂô®Ê®£Âºè - ÊîπÈÄ≤ÈüøÊáâÂºèË®≠Ë®à */
        .navigation {
            margin-bottom: 20px;
            display: flex;
            justify-content: flex-start;
            flex-wrap: wrap;
            gap: 4px;
            min-height: 30px;
        }

        .nav-btn {
            background: #F7E0C3;
            color: #132234;
            border: 2px outset #F7E0C3;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: normal;
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
            display: flex;
            align-items: center;
            gap: 4px;
            min-width: 80px;
            justify-content: center;
            flex: 0 0 auto;
        }

        .nav-btn:hover {
            background: #68AAB2;
            border-color: #68AAB2;
        }

        .nav-btn:active {
            border: 2px inset #F7E0C3;
        }

        .nav-btn.active {
            background: #1F3D5D;
            color: #F7E0C3;
            border: 2px inset #F7E0C3;
        }

        .nav-icon {
            width: 12px;
            height: 12px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .panel {
            margin-top: 8px;
            background: #F7E0C3;
            border: 2px outset #F7E0C3;
            padding: 8px;
            box-shadow: 2px 2px 1px #132234;
        }

        .panel h2 {
            color: #132234;
            margin-bottom: 8px;
            font-size: 11px;
            font-weight: bold;
            background: #1F3D5D;
            color: #F7E0C3;
            padding: 2px 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .panel-icon {
            width: 12px;
            height: 12px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 4px;
            margin-bottom: 8px;
        }

        .template-btn {
            background: #F7E0C3;
            color: #132234;
            border: 2px outset #F7E0C3;
            padding: 4px 8px;
            font-size: 11px;
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
            gap: 4px;
            margin-top: 4px;
            align-items: center;
            justify-content: center;
        }

        .template-btn:hover {
            background: #68AAB2;
            border-color: #68AAB2;
        }

        .template-btn:active {
            border: 2px inset #F7E0C3;
        }

        .quick-btn {
            background: #F7E0C3;
            color: #132234;
            border: 2px outset #F7E0C3;
            padding: 2px 6px;
            font-size: 11px;
            margin: 2px;
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .quick-btn:hover {
            background: #68AAB2;
            border-color: #68AAB2;
        }

        .quick-btn:active {
            border: 2px inset #F7E0C3;
        }

        .input-group {
            margin-bottom: 8px;
        }

        .input-group label {
            display: block;
            margin-bottom: 2px;
            font-weight: normal;
            color: #132234;
            font-size: 11px;
        }

        input, textarea, select {
            width: 100%;
            padding: 2px;
            border: 2px inset #E5D0BB;
            background: #E5D0BB;
            color: #132234;
            font-size: 11px;
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
        }

        input:focus, textarea:focus, select:focus {
            outline: 1px dotted #132234;
        }

        textarea {
            min-height: 60px;
            resize: vertical;
        }

        .output-area {
            grid-column: 1 / -1;
        }

        #output, #checkerOutput {
            background: #E5D0BB;
            color: #132234;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.2;
            min-height: 120px;
            padding: 4px;
            white-space: pre-wrap;
            overflow-y: auto;
            border: 2px inset #F7E0C3;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .action-btns {
            display: flex;
            gap: 4px;
            margin-top: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            background: #F7E0C3;
            color: #132234;
            border: 2px outset #F7E0C3;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: normal;
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .action-btn:hover, .toggle-btn:hover {
            background: #68AAB2;
            border-color: #68AAB2;
        }

        .action-btn:active {
            border: 2px inset #F7E0C3;
        }

        .world-book-panel {
            background: #F7E0C3;
            color: #F7E0C3;
            border: 2px outset #F7E0C3;
            box-shadow: 2px 2px 1px #132234;
        }

        .world-book-panel h3 {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: bold;
        }

        .world-book-panel input {
            background: #E5D0BB;
            color: #132234;
        }

        .world-book-panel label {
            color: #132234;
        }

        .world-book-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
            margin-bottom: 8px;
        }

        .number-input {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .number-input button {
            width: 20px;
            height: 20px;
            border: 2px outset #F7E0C3;
            background: #F7E0C3;
            color: #132234;
            font-size: 11px;
            font-weight: bold;
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
        }

        .number-input button:hover {
            background: #68AAB2;
            border-color: #68AAB2;
        }

        .number-input button:active {
            border: 2px inset #F7E0C3;
        }

        .number-input input {
            width: 40px;
            text-align: center;
        }

        .repeat-controls {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: wrap;
        }

        .btn-icon {
            width: 12px;
            height: 12px;
        }

        /* Windows 98 ÁâπÊúâÊïàÊûú */
        .window-title {
            background: #1F3D5D;
            color: #F7E0C3;
            padding: 2px;
            font-size: 11px;
            font-weight: bold;
            margin: -8px -8px 8px -8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-bar {
            background: #FCEAD1;
            border: 1px inset #FCEAD1;
            padding: 2px 4px;
            font-size: 11px;
            margin-top: 8px;
            display: flex;
            justify-content: space-between;
        }

        /* Êñ∞Â¢ûÔºöÈóúÈçµË©ûËº∏ÂÖ•Ê¨Ñ‰ΩçÁöÑË¶ñË¶∫ÂàÜÈöîÁ¨¶Ëôü */
        .keyword-input {
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }

        .keyword-help {
            background: #E5D0BB !important;
            font-size: 10px;
            color: #132234;
            margin-top: 2px;
            line-height: 1.3;
        }

        /* Â°´ÂÖ•Á¨¶ËôüÂçÄÂüüÊ®£Âºè */
        .symbol-section {
            border-top: 1px solid #E5D0BB;
            margin-top: 8px;
            padding-top: 8px;
        }

        .symbol-buttons {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            margin-top: 4px;
        }

        .symbol-btn {
            background: #F7E0C3;
            color: #132234;
            border: 2px outset #F7E0C3;
            padding: 2px 6px;
            font-size: 11px;
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            min-width: 60px;
            justify-content: center;
        }

        .symbol-btn:hover {
            background: #68AAB2;
            border-color: #68AAB2;
        }

        .symbol-btn:active {
            border: 2px inset #F7E0C3;
        }

        /* È†ÅÈù¢È°ØÁ§∫ÊéßÂà∂ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* È¶ñÈ†ÅÁâπÊÆäÊ®£Âºè */
        .home-info {
            background: rgba(246, 200, 184, 0.1);
            border-radius: 2px;
            padding: 8px;
            line-height: 1.4;
        }

        .home-info ul {
            margin-left: 16px;
            margin-top: 4px;
        }

        .home-info li {
            margin-bottom: 4px;
        }

        /* ÊñáÊú¨Ê™¢Êü•Âô®Ê®£Âºè */
        .toggle-btn {
            background: #F7E0C3;
            color: #132234;
            border: 2px outset #F7E0C3;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: normal;
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
            gap: 4px;
            margin-top: 4px;
            align-items: center;
            justify-content: center;
        }

        .toggle-btn.active {
            background: #68AAB2;
            border: 2px inset #F7E0C3;
        }

        .preview-panel {
            width: 100%;
            padding: 2px;
            border: 2px inset #E5D0BB;
            background: #E5D0BB;
            color: #132234;
            font-size: 11px;
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
            min-height: 60px;
            resize: vertical;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
            display: none;
        }

        .preview-panel.active {
            display: block;
        }

        #previewContent {
        width: 100%;
        padding: 2px;
        border: 2px inset #E5D0BB;
        background: #E5D0BB;
        color: #132234;
        font-size: 11px;
        font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
         min-height: 60px;
        resize: vertical;
        line-height: 1.6;
        white-space: pre-wrap;
        word-break: break-word;
        outline: none;
        cursor: text;
        }

        #previewContent:focus {
            outline: 1px dotted #132234;
        }

        /* Âç≥ÊôÇÈ†êË¶ΩÈ´ò‰∫ÆÊ®£Âºè */
        .highlight-whitespace {
            background-color: #d6c4b8;
            color: white;
            padding: 2px 4px;
            font-weight: bold;
        }

        .highlight-colon {
            background-color: #64caa0;
            color: white;
            padding: 2px 4px;
            font-weight: bold;
        }

        .highlight-user {
            background-color: #5786b8;
            color: white;
            padding: 2px 4px;
            font-weight: bold;
        }

        .highlight-char {
            background-color: #c5577c;
            color: white;
            padding: 2px 4px;
            font-weight: bold;
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
        }

        /* TokenË®àÊï∏Âô®Ê®£Âºè */
        .token-container {
            position: relative;
        }

        .token-counter {
            position: absolute;
            top: -20px;
            right: 0;
            background: #1F3D5D;
            color: #F7E0C3;
            padding: 2px 6px;
            font-size: 10px;
            border-radius: 2px;
            font-weight: bold;
        }

        .token-input {
            min-height: 120px;
            font-family: 'Courier New', monospace;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                üöÇRMT Station‚ñ™Ô∏èSimple Creation Assistant
            </h1>
            <h2>
                üöÇRMT ËªäÁ´ô‚ñ™Ô∏èÁ∞°ÊòìÂâµ‰ΩúÂä©Êâã_v1 20250820
            </h2>
        </div>

        <!-- ÂÖ®ÂüüÁãÄÊÖãÈ°ØÁ§∫ÂçÄÂüü -->
        <div class="global-status" id="globalStatus">
                Áï∂ÂâçÈ†ÅÈù¢ÔºöÈ¶ñÈ†Å
        </div>

        <!-- È†ÅÈù¢Â∞éË¶ΩÂô® -->
        <div class="navigation">
            <button class="nav-btn active" onclick="navigateToPage('home')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
                È¶ñÈ†Å
            </button>
            <button class="nav-btn" onclick="navigateToPage('worldbook')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
                ‰∏ñÁïåÊõ∏Ëß∏ÁôºÊ®°Êùø
            </button>
            <button class="nav-btn" onclick="navigateToPage('checker')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4"/>
                    <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                    <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                    <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"/>
                    <path d="M12 21c0-1-1-3-3-3s-3 2-3 3 1 3 3 3 3-2 3-3"/>
                </svg>
                ÊñáÊú¨Ê™¢Êü•Âô®
            </button>
            <button class="nav-btn" onclick="navigateToPage('token')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
                    <path d="M9 12l2 2 4-4"/>
                </svg>
                TokenË®àÊï∏Âô®
            </button>
        </div>

        <!-- È¶ñÈ†Å -->
        <div id="home-page" class="page active">
            <div class="panel">
                <div class="window-title">
                    <svg class="panel-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    Ê≠°Ëøé‰ΩøÁî® RMTËªäÁ´ôÁöÑÁ∞°ÊòìÂâµ‰ΩúÂä©Êâã
                </div>
                <div class="home-info">
                    <strong>‚ñº ÂäüËÉΩ‰ªãÁ¥πÔºö</strong><br>
                    <ul>
                        <li>‰∏ñÁïåÊõ∏Ëß∏ÁôºÊ®°ÊùøÔºöÊèê‰æõÂø´ÈÄüÁîüÊàêRegexËß∏ÁôºÁöÑÈóúÈçµÂ≠ó</li>
                        <li>ÊñáÊú¨Ê™¢Êü•Âô®ÔºöÊ™¢Êü•Ëº∏ÂÖ•ÁöÑÂêÑÁ®ÆË¶ÅÁ¥†ÔºåÈôÑÂ∏∂Âç≥ÊôÇÈ†êË¶ΩÊ®°ÂºèÔºåÂèØÂêåÊôÇ‰øÆÊîπÊ™¢Êü•ÊñáÊú¨</li>
                        <li>TokenË®àÊï∏Âô®ÔºöÂç≥ÊôÇË®àÁÆóËº∏ÂÖ•ÊñáÊú¨ÁöÑTokensÂ≠óÁ¨¶ÔºåÂÉÖ‰æõÂèÉËÄÉ</li>
                
                    <br>
                    </ul>
                    <strong>‚úé ‰ΩøÁî®Ë™™ÊòéÔºö</strong><br>
                    <ul>
                    <li>ÈªûÊìä‰∏äÊñπÂ∞éË¶ΩÊåâÈàïÂàáÊèõ‰∏çÂêåÂäüËÉΩÈ†ÅÈù¢</li>
                    <li>ÁîüÊàêÁöÑÂÖßÂÆπÈÉΩÂèØ‰ª•Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÊàñÂÑ≤Â≠òÁÇ∫Êñá‰ª∂</li>
                    </ul>
                    <br>
                    <strong>‚öë Êõ¥Êñ∞Ê≠∑Á®ãÔºö</strong><br>
                    <ul>
                    <li>2025/08/20_Êñ∞Â¢ûÊõ¥Â§öËß∏ÁôºÊ®°ÊùøÔºåcssÊúÄÁµÇË™øÊï¥</li>
                    <li>2025/08/19_Ë™øÊï¥ÂàÜË©ûÂô®ÔºåÊõ¥Ë∂®ËøëÁúüÂØ¶</li>
                    <li>2025/08/18_v1ÂàùÁâàÂÆåÊàê</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ‰∏ñÁïåÊõ∏Ëß∏ÁôºÊ®°ÊùøÈ†ÅÈù¢ -->
        <div id="worldbook-page" class="page">
            <div class="panel world-book-panel">
                <div class="window-title">
                    <svg class="panel-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    </svg>
                    Ë®≠ÁΩÆRegexËß∏Áôº (ÈóúÈçµË©û Key)
                </div>
                <div class="keyword-help" style="margin-bottom: 8px; padding: 4px; background: rgba(246, 200, 184, 0.1); border-radius: 2px;">
                    <strong>ÈóúÈçµË©ûËº∏ÂÖ•Ë™™ÊòéÔºö</strong><br>
                    ‚Ä¢ ‰ΩøÁî® <code>|</code> ÂàÜÈöîÂ§öÂÄãÈÅ∏È†ÖÔºàÂ¶ÇÔºöÊàë|Â¶≥|‰ªñÔºâ<br>
                    ‚Ä¢ ‰ΩøÁî® <code>, </code> Ëº∏ÂÖ•ÊúÉËá™ÂãïËΩâÊèõÁÇ∫ <code>|</code>ÔºàÂ¶ÇÔºöÊàë, Â¶≥ ‚Üí Êàë|Â¶≥Ôºâ<br>
                    ‚Ä¢ Á©∫ÁôΩÁöÑ <code>|</code> ÂçÄÊÆµÂ∞áËá™ÂãïÁßªÈô§
                </div>
                <div class="world-book-controls">
                    <div class="input-group">
                        <label>‰∏≠Èñì(?:text)ÊÆµÊï∏Èáè:</label>
                        <div class="number-input">
                            <button onclick="changeWorldBookCount(-1)">-</button>
                            <input type="number" id="worldBookCount" value="1" min="0">
                            <button onclick="changeWorldBookCount(1)">+</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <button class="template-btn" onclick="setupWorldBookInputs()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 20h9"/>
                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                            </svg>
                            Ë®≠ÂÆöÈóúÈçµË©û
                        </button>
    <button class="template-btn" onclick="generateWorldBook()" style="margin-top: 4px;">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9,11 12,14 22,4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
        </svg>
        ÁîüÊàêÈÄ£Êé•ÂûãÊ®°Êùø
    </button>
    <button class="template-btn" onclick="generateWorldBook2()" style="margin-top: 4px;">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9,11 12,14 22,4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
        </svg>
        ÁîüÊàêÊôÆÈÄöÂûãÊ®°Êùø
    </button>
                    </div>
                </div>

                <!-- Â°´ÂÖ•Á¨¶ËôüÂçÄÂüü -->
                <div class="symbol-section">
                    <label style="color: #132234; font-weight: bold; margin-bottom: 4px; display: block;">Â°´ÂÖ•Á¨¶Ëôü:</label>
                    <div class="symbol-buttons">
                        <button class="symbol-btn" onclick="insertSymbol('separator')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            ÂàÜÈöîÁ∑ö
                        </button>
                        <button class="symbol-btn" onclick="insertSymbol('bracket1')">

                            [
                        </button>
                        <button class="symbol-btn" onclick="insertSymbol('bracket2')">
                            ]
                        </button>
                        <button class="symbol-btn" onclick="insertSymbol('hash')">
                            ###
                        </button>
                    </div>
                </div>

                <div id="worldBookInputs" class="world-book-controls" style="display: none; margin-top: 8px; border-top: 1px solid #F7E0C3; padding-top: 8px;">
                    <!-- ÂãïÊÖãÁîüÊàêÁöÑËº∏ÂÖ•Ê°ÜÊúÉÂá∫ÁèæÂú®ÈÄôË£° -->
                </div>
            </div>

            <div class="panel output-area">
                <div class="window-title">
                    <svg class="panel-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 5H7a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h2m0-18h2.5a2.5 2.5 0 0 1 0 5H11h.5a2.5 2.5 0 0 1 0 5H11"/>
                        <path d="M5 5l14 14"/>
                        <path d="m19 5-14 14"/>
                    </svg>
                    Ëº∏Âá∫ÁµêÊûú
                </div>
                <div id="output">ÈªûÊìä‰∏äÊñπÊåâÈàï‰æÜÁîüÊàêÊ®°Êùø...</div>
                <div class="action-btns">
                    <button class="action-btn" onclick="copyToClipboard()">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                        Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø
                    </button>
                    <button class="action-btn" onclick="clearOutput()">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Ê∏ÖÁ©∫Ëº∏Âá∫
                    </button>
                    <button class="action-btn" onclick="saveAsFile()">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17,21 17,13 7,13 7,21"/>
                            <polyline points="7,3 7,8 15,8"/>
                        </svg>
                        ÂÑ≤Â≠òÁÇ∫Ê™îÊ°à
                    </button>
                </div>
                <div class="status-bar">
                    <span>Â∞±Á∑í</span>
                    <span id="statusText">Á≠âÂæÖÊìç‰Ωú</span>
                </div>
            </div>
        </div>

<!-- ÊñáÊú¨Ê™¢Êü•Âô®È†ÅÈù¢ -->
    <div id="checker-page" class="page">
        <div class="panel">
            <div class="window-title">
                <svg class="panel-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4"/>
                    <circle cx="12" cy="12" r="9"/>
                </svg>
                ÊñáÊú¨Ê™¢Êü•Âô®
            </div>
            <div class="input-group">
                <label>Ëº∏ÂÖ•Ë¶ÅÊ™¢Êü•ÁöÑÊñáÊú¨:</label>
                <textarea id="checkerInput" class="checker-input" placeholder="Ë´ãËº∏ÂÖ•Ë¶ÅÊ™¢Êü•ÁöÑÊñáÊú¨ÂÖßÂÆπ..."></textarea>
            </div>
            <div class="checker-buttons">
                <button class="toggle-btn" id="previewToggle" onclick="togglePreview()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    Âç≥ÊôÇÈ†êË¶Ω
                </button>
                <button class="template-btn" onclick="checkLength()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        <polyline points="7.5,10.5 12,15 16.5,10.5"/>
                    </svg>
                    Ê™¢Êü•Èï∑Â∫¶
                </button>
                <button class="template-btn" onclick="checkSpaces()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6"/>
                        <path d="m21 12-6 0m-6 0-6 0"/>
                    </svg>
                    Á©∫ÁôΩÂ≠óÁ¨¶
                </button>
            </div>
        </div>

        <div class="panel output-area">
            <div class="window-title">
                <svg class="panel-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14,2 14,8 20,8"/>
                </svg>
                Ê™¢Êü•ÁµêÊûú
            </div>
            
            <!-- ÂÇ≥Áµ±Ê™¢Êü•ÁµêÊûú -->
            <div id="checkerOutput">Ë´ãËº∏ÂÖ•ÊñáÊú¨‰∏¶ÈÅ∏ÊìáÊ™¢Êü•È†ÖÁõÆ...</div>
            
            <!-- Âç≥ÊôÇÈ†êË¶ΩÈù¢Êùø -->
            <div id="previewPanel" class="preview-panel">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #64caa0;"></div>
                        <span>ÂÜíËôü</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #d6c4b8;"></div>
                        <span>Á©∫Ê†º</span>
                        </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #5786b8;"></div>
                        <span>user</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #c5577c;"></div>
                        <span>char</span>
                    </div>
                </div>
                <div id="previewContent" contenteditable="true">Ë´ãËº∏ÂÖ•ÊñáÊú¨‰ª•Êü•ÁúãÂç≥ÊôÇÈ†êË¶Ω...</div>
            </div>
            
            <div class="action-btns">
                <button class="action-btn" onclick="copyCheckerResult()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                    </svg>
                    Ë§áË£ΩÁµêÊûú
                </button>
                <button class="action-btn" onclick="clearCheckerOutput()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    Ê∏ÖÁ©∫ÁµêÊûú
                </button>
            </div>
            <div class="status-bar">
                <span>Â∞±Á∑í</span>
                <span id="checkerStatusText">Á≠âÂæÖÊìç‰Ωú</span>
            </div>
        </div>
    </div>

    
        <!-- TokenË®àÊï∏Âô®È†ÅÈù¢ -->
        <div id="token-page" class="page">
            <div class="panel">
                <div class="window-title">
                    <svg class="panel-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
                        <path d="M9 12l2 2 4-4"/>
                    </svg>
                    TokenË®àÊï∏Âô®
                </div>
                <div class="input-group">
                    <label>Ëº∏ÂÖ•Ë¶ÅË®àÁÆóTokenÁöÑÊñáÊú¨:</label>
                    <div class="token-container">
                        <div class="token-counter" id="tokenCounter">Tokens: 0</div>
                        <textarea id="tokenInput" class="token-input" placeholder="Ë´ãËº∏ÂÖ•Ë¶ÅË®àÁÆóTokenÊï∏ÈáèÁöÑÊñáÊú¨..." oninput="calculateTokens()"></textarea>
                    </div>
                </div>
                <div class="keyword-help" style="margin-top: 8px; padding: 4px; background: rgba(246, 200, 184, 0.1); border-radius: 2px;">
                    <strong>TokenË®àÁÆóË™™ÊòéÔºö</strong><br>
                    ‚Ä¢ TokenË®àÁÆóÂü∫ÊñºÂ≠óÁ¨¶Êï∏ÁöÑÁ∞°Á¥Ñ‰º∞ÁÆóÂÖ¨Âºè<br>
                    ‚Ä¢ ÂØ¶ÈöõTokenÊï∏ÂèØËÉΩÂõ†Ê®°ÂûãËÄåÁï∞ÔºåÂÉÖ‰æõÂèÉËÄÉ<br>
                    ‚Ä¢ ÂØ¶Áî®TokenizerÁ∂≤Á´ôÊé®Ëñ¶:Open.AI
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 'home';

        // Êõ¥Êñ∞ÂÖ®ÂüüÁãÄÊÖãÈ°ØÁ§∫ÁöÑÂáΩÊï∏
        function updateGlobalStatus(pageName) {
            const globalStatus = document.getElementById('globalStatus');
            if (globalStatus) {
                globalStatus.textContent = `Áï∂ÂâçÈ†ÅÈù¢Ôºö${pageName}`;
            }
        }

        function updateStatus(text) {
            const statusElement = document.getElementById('statusText');
            if (statusElement) {
                statusElement.textContent = text;
            }
        }

        // Êñ∞Â¢ûÔºöÊõ¥Êñ∞Ê™¢Êü•Âô®ÁãÄÊÖãÁöÑÂáΩÊï∏
        function updateCheckerStatus(text) {
            const statusElement = document.getElementById('checkerStatusText');
            if (statusElement) {
                statusElement.textContent = text;
            }
        }

        // È†ÅÈù¢Â∞éË¶ΩÂäüËÉΩ - ‰øÆÂæ©ÂæåÁöÑÁâàÊú¨
        function navigateToPage(page) {
            // Èö±ËóèÊâÄÊúâÈ†ÅÈù¢
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            
            // ÁßªÈô§ÊâÄÊúâactiveÈ°ûÂà•
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ÁÇ∫Áï∂ÂâçÈ†ÅÈù¢ÊåâÈàïÊ∑ªÂä† activeÈ°ûÂà•
            event.target.closest('.nav-btn').classList.add('active');
            
            // È°ØÁ§∫Â∞çÊáâÈ†ÅÈù¢
            const targetPage = document.getElementById(page + '-page');
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = page;
            }
            
            // Êõ¥Êñ∞È†ÅÈù¢ÁãÄÊÖãÈ°ØÁ§∫
            const pageNames = {
                'home': 'È¶ñÈ†Å',
                'worldbook': '‰∏ñÁïåÊõ∏Ëß∏ÁôºÊ®°Êùø',
                'checker': 'ÊñáÊú¨Ê™¢Êü•Âô®',
                'token': 'TokenË®àÊï∏Âô®'
            };
            
            const pageName = pageNames[page] || 'Êú™Áü•È†ÅÈù¢';
            updateGlobalStatus(pageName);
        }

        // Â°´ÂÖ•Á¨¶ËôüÂäüËÉΩ
        function insertSymbol(type) {
            let value;
            
            switch (type) {
                case 'separator':
                    value = '='.repeat(50);
                    break;
                case 'bracket1':
                    value = '[';
                    break;
                case 'bracket2':
                    value = ']';
                    break;
                case 'hash':
                    value = '###';
                    break;
            }

            const output = document.getElementById('output');
            if (output.textContent.includes('ÈªûÊìä‰∏äÊñπÊåâÈàï‰æÜÁîüÊàêÊ®°Êùø...')) {
                output.textContent = value;
            } else {
                output.textContent += (output.textContent.trim() ? '\n' : '') + value;
            }
            
            updateStatus(`Â∑≤ÊèíÂÖ•${getSymbolName(type)}`);
        }

        function getSymbolName(type) {
            const names = {
                'separator': 'ÂàÜÈöîÁ∑ö',
                'bracket1': '‰∏äÊñπÊã¨Ëôü',
                'bracket2': '‰∏ãÊñπÊã¨Ëôü',
                'hash': '‰∫ïËôü'
            };
            return names[type] || 'Á¨¶Ëôü';
        }

// Êñ∞Â¢ûÔºöËôïÁêÜÈóúÈçµË©ûÁöÑÂáΩÊï∏
function processKeywords(inputValue) {
    if (!inputValue.trim()) return '';
    
    // ÂÖàÂ∞á ', ' ÊõøÊèõÁÇ∫ '|'
    let processed = inputValue.replace(/,\s+/g, '|');
    
    // ÁßªÈô§Á©∫ÁöÑÊÆµËêΩÔºàÈÄ£Á∫åÁöÑ | ÊàñÈñãÈ†≠ÁµêÂ∞æÁöÑ |Ôºâ
    processed = processed
        .split('|')
        .filter(segment => segment.trim() !== '')
        .join('|');
    
    return processed;
}

function setupWorldBookInputs() {
    const count = parseInt(document.getElementById('worldBookCount').value) || 0;
    const inputsContainer = document.getElementById('worldBookInputs');
    
    // Ê∏ÖÁ©∫ÁèæÊúâËº∏ÂÖ•Ê°Ü
    inputsContainer.innerHTML = '';
    
    // Á∏ΩÊòØÊúâÈñãÈ†≠Ëº∏ÂÖ•Ê°Ü
    const startInputGroup = document.createElement('div');
    startInputGroup.className = 'input-group';
    startInputGroup.innerHTML = `
        <label for="worldBookStart">ÈñãÈ†≠ÈóúÈçµË©û:</label>
        <input type="text" id="worldBookStart" class="keyword-input" placeholder="Ëº∏ÂÖ•ÈñãÈ†≠ÈóúÈçµË©ûÔºàÊîØÊè¥ | Êàñ , ÂàÜÈöîÂ§öÈÅ∏È†ÖÔºâ">
        <div class="keyword-help">ÁØÑ‰æãÔºöÊàë|‰Ω†|‰ªñ|{{user}}|{{char}} Êàñ Êàë, ‰Ω†, ‰ªñ, {{user}}, {{char}}</div>
    `;
    inputsContainer.appendChild(startInputGroup);
    
    // ÁîüÊàê‰∏≠ÈñìÊÆµËº∏ÂÖ•Ê°Ü
    for (let i = 1; i <= count; i++) {
        const inputGroup = document.createElement('div');
        inputGroup.className = 'input-group';
        inputGroup.innerHTML = `
            <label for="worldBookMiddle${i}">‰∏≠ÈñìÈóúÈçµË©û ${i}:</label>
            <input type="text" id="worldBookMiddle${i}" class="keyword-input" placeholder="Ëº∏ÂÖ•Á¨¨${i}ÂÄã‰∏≠ÈñìÈóúÈçµË©ûÔºàÊîØÊè¥ | Êàñ , ÂàÜÈöîÂ§öÈÅ∏È†ÖÔºâ">
            <div class="keyword-help">ÁØÑ‰æãÔºöË∑ëÂêë|ÊÑõ|ÁúãÂà∞|ÁöÑ|Âú∞ Êàñ Ë∑ëÂêë, ÊÑõ, ÁúãÂà∞, ÁöÑ, Âú∞</div>
        `;
        inputsContainer.appendChild(inputGroup);
    }
    
    // Á∏ΩÊòØÊúâÁµêÂ∞æËº∏ÂÖ•Ê°Ü
    const endInputGroup = document.createElement('div');
    endInputGroup.className = 'input-group';
    endInputGroup.innerHTML = `
        <label for="worldBookEnd">ÁµêÂ∞æÈóúÈçµË©û:</label>
        <input type="text" id="worldBookEnd" class="keyword-input" placeholder="Ëº∏ÂÖ•ÁµêÂ∞æÈóúÈçµË©ûÔºàÊîØÊè¥ | Êàñ , ÂàÜÈöîÂ§öÈÅ∏È†ÖÔºâ">
        <div class="keyword-help">ÁØÑ‰æãÔºö‰ªñ|{{char}}|Âóé|Âë¢|ÈÇ£Ë£° Êàñ ‰ªñ, {{char}}, Âóé, Âë¢, ÈÇ£Ë£°</div>
    `;
    inputsContainer.appendChild(endInputGroup);
    
    inputsContainer.style.display = 'grid';
    updateStatus('Â∑≤Ë®≠ÂÆöÈóúÈçµË©ûËº∏ÂÖ•Ê°Ü');
}

function generateWorldBook() {
    const count = parseInt(document.getElementById('worldBookCount').value) || 0;
    
    // Ê™¢Êü•ÊòØÂê¶Â∑≤Ë®≠ÂÆöËº∏ÂÖ•Ê°Ü
    const inputsContainer = document.getElementById('worldBookInputs');
    if (inputsContainer.style.display === 'none' || inputsContainer.children.length === 0) {
        alert('Ë´ãÂÖàÈªûÊìä„ÄåË®≠ÂÆöÈóúÈçµË©û„ÄçÊåâÈàï');
        return;
    }
    
    // ÂèñÂæóÈñãÈ†≠ÂíåÁµêÂ∞æÈóúÈçµË©û
    const startInput = document.getElementById('worldBookStart');
    const endInput = document.getElementById('worldBookEnd');
    
    const startKeyword = startInput ? processKeywords(startInput.value) : '';
    const endKeyword = endInput ? processKeywords(endInput.value) : '';
    
    if (!startKeyword) {
        alert('Ë´ãÂ°´ÂÖ•ÈñãÈ†≠ÈóúÈçµË©û');
        return;
    }
    if (!endKeyword) {
        alert('Ë´ãÂ°´ÂÖ•ÁµêÂ∞æÈóúÈçµË©û');
        return;
    }
    
    // Êî∂ÈõÜ‰∏≠ÈñìÈóúÈçµË©û
    const middleKeywords = [];
    for (let i = 1; i <= count; i++) {
        const input = document.getElementById(`worldBookMiddle${i}`);
        const processedValue = input ? processKeywords(input.value) : '';
        if (!processedValue) {
            alert(`Ë´ãÂ°´ÂÖ•‰∏≠ÈñìÈóúÈçµË©û ${i}`);
            return;
        }
        middleKeywords.push(processedValue);
    }

    // ÁîüÊàêÈÄ£Êé•ÂûãÊ®°Êùø
    let newTemplate = `# ‰∏ñÁïåÊõ∏(RegexËß∏Áôº)
## ÈóúÈçµË©û/Key(ÈÄ£Êé•Âûã)
/(?:${startKeyword})`;

    // Ê∑ªÂä†‰∏≠ÈñìÁöÑ.*?(?:keyword)ÊÆµ
    for (let i = 0; i < middleKeywords.length; i++) {
        newTemplate += `.*?(?:${middleKeywords[i]})`;
    }
    
    // Ê∑ªÂä†ÁµêÂ∞æ
    newTemplate += `.*?(?:${endKeyword})/i`;
    
    // Áç≤ÂèñÁèæÊúâÂÖßÂÆπ‰∏¶ËøΩÂä†Êñ∞Ê®°Êùø
    const outputElement = document.getElementById('output');
    if (outputElement.textContent.includes('ÈªûÊìä‰∏äÊñπÊåâÈàï‰æÜÁîüÊàêÊ®°Êùø...')) {
        outputElement.textContent = newTemplate;
    } else {
        outputElement.textContent += (outputElement.textContent.trim() ? '\n' : '') + newTemplate;
    }
    
    updateStatus('ÈÄ£Êé•ÂûãÊ®°ÊùøÂ∑≤ÁîüÊàê');
}


function generateWorldBook2() {
    const count = parseInt(document.getElementById('worldBookCount').value) || 0;
    
    // Ê™¢Êü•ÊòØÂê¶Â∑≤Ë®≠ÂÆöËº∏ÂÖ•Ê°Ü
    const inputsContainer = document.getElementById('worldBookInputs');
    if (inputsContainer.style.display === 'none' || inputsContainer.children.length === 0) {
        alert('Ë´ãÂÖàÈªûÊìä„ÄåË®≠ÂÆöÈóúÈçµË©û„ÄçÊåâÈàï');
        return;
    }
    
    // ÂèñÂæóÈñãÈ†≠ÂíåÁµêÂ∞æÈóúÈçµË©û
    const startInput = document.getElementById('worldBookStart');
    const endInput = document.getElementById('worldBookEnd');
    
    const startKeyword = startInput ? processKeywords(startInput.value) : '';
    const endKeyword = endInput ? processKeywords(endInput.value) : '';
    
    if (!startKeyword) {
        alert('Ë´ãÂ°´ÂÖ•ÈñãÈ†≠ÈóúÈçµË©û');
        return;
    }
    if (!endKeyword) {
        alert('Ë´ãÂ°´ÂÖ•ÁµêÂ∞æÈóúÈçµË©û');
        return;
    }
    
    // Êî∂ÈõÜ‰∏≠ÈñìÈóúÈçµË©û
    const middleKeywords = [];
    for (let i = 1; i <= count; i++) {
        const input = document.getElementById(`worldBookMiddle${i}`);
        const processedValue = input ? processKeywords(input.value) : '';
        if (!processedValue) {
            alert(`Ë´ãÂ°´ÂÖ•‰∏≠ÈñìÈóúÈçµË©û ${i}`);
            return;
        }
        middleKeywords.push(processedValue);
    }

    // ÁîüÊàêÊôÆÈÄöÂûãÊ®°ÊùøÔºà‰∏ç‰ΩøÁî®.*?ÈÄ£Êé•Ôºâ
    let newTemplate = `# ‰∏ñÁïåÊõ∏(RegexËß∏Áôº)
## ÈóúÈçµË©û/Key(ÊôÆÈÄöÂûã)
/(?:${startKeyword})`;

    // Áõ¥Êé•ÈÄ£Êé•‰∏≠ÈñìÈóúÈçµË©ûÔºå‰∏ç‰ΩøÁî®.*?
    for (let i = 0; i < middleKeywords.length; i++) {
        newTemplate += `(?:${middleKeywords[i]})`;
    }
    
    // Ê∑ªÂä†ÁµêÂ∞æ
    newTemplate += `(?:${endKeyword})/i`;
    
    // Áç≤ÂèñÁèæÊúâÂÖßÂÆπ‰∏¶ËøΩÂä†Êñ∞Ê®°Êùø
    const outputElement = document.getElementById('output');
    if (outputElement.textContent.includes('ÈªûÊìä‰∏äÊñπÊåâÈàï‰æÜÁîüÊàêÊ®°Êùø...')) {
        outputElement.textContent = newTemplate;
    } else {
        outputElement.textContent += (outputElement.textContent.trim() ? '\n' : '') + newTemplate;
    }
    
    updateStatus('ÊôÆÈÄöÂûãÊ®°ÊùøÂ∑≤ÁîüÊàê');
}

function changeWorldBookCount(delta) {
    const input = document.getElementById('worldBookCount');
    const current = parseInt(input.value) || 1;
    const newValue = Math.max(0, current + delta);
    input.value = newValue;
    
    // Â¶ÇÊûúËº∏ÂÖ•Ê°ÜÂ∑≤Á∂ìÈ°ØÁ§∫ÔºåËá™ÂãïÊõ¥Êñ∞
    const inputsContainer = document.getElementById('worldBookInputs');
    if (inputsContainer.style.display !== 'none') {
        setupWorldBookInputs();
    }
    updateStatus(`‰∏≠ÈñìÊÆµÊï∏Èáè: ${newValue}`);
}

        function copyToClipboard() {
            const output = document.getElementById('output').textContent;
            if (!output.trim() || output.includes('ÈªûÊìä‰∏äÊñπÊåâÈàï‰æÜÁîüÊàêÊ®°Êùø')) {
                alert('Ê≤íÊúâÂÖßÂÆπÂèØ‰ª•Ë§áË£Ω');
                return;
            }

            navigator.clipboard.writeText(output).then(() => {
                alert('Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ');
                updateStatus('Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø');
            }).catch(() => {
                // ÂÇôÁî®ÊñπÊ≥ï
                const textarea = document.createElement('textarea');
                textarea.value = output;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ');
                updateStatus('Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø');
            });
        }

        function clearOutput() {
            document.getElementById('output').textContent = 'ÈªûÊìä‰∏äÊñπÊåâÈàï‰æÜÁîüÊàêÊ®°Êùø...';
            updateStatus('Ëº∏Âá∫Â∑≤Ê∏ÖÁ©∫');
        }

        function saveAsFile() {
            const output = document.getElementById('output').textContent;
            if (!output.trim() || output.includes('ÈªûÊìä‰∏äÊñπÊåâÈàï‰æÜÁîüÊàêÊ®°Êùø')) {
                alert('Ê≤íÊúâÂÖßÂÆπÂèØ‰ª•ÂÑ≤Â≠ò');
                return;
            }

            const blob = new Blob([output], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'worldbook_template.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            updateStatus('Ê™îÊ°àÂ∑≤ÂÑ≤Â≠ò');
        }

        // Âç≥ÊôÇÈ†êË¶ΩÂäüËÉΩ
        let isPreviewMode = false;
        let isUpdatingFromPreview = false;
        let previewHistory = []; // Êí§Èä∑Ê≠∑Âè≤Ë®òÈåÑ
        let historyIndex = -1; // Áï∂ÂâçÊ≠∑Âè≤Á¥¢Âºï
        let lastSavedSelection = null; // ÂÑ≤Â≠òÁöÑÈÅ∏ÊìáÁØÑÂúç

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('checkerInput');
            const previewContent = document.getElementById('previewContent');
            
            input.addEventListener('input', handleInputChange);
            previewContent.addEventListener('input', handlePreviewChange);
            previewContent.addEventListener('keydown', handlePreviewKeydown);
            previewContent.addEventListener('beforeinput', handlePreviewBeforeInput);
            
            // Èò≤Ê≠¢È†êË¶ΩÈù¢Êùø‰∏≠ÁöÑÊüê‰∫õÈªòË™çË°åÁÇ∫
            previewContent.addEventListener('paste', function(e) {
                e.preventDefault();
                const text = e.clipboardData.getData('text/plain');
                insertTextAtCursor(text);
                saveToHistory();
            });

            // Áõ£ËÅΩÁÑ¶Èªû‰∫ã‰ª∂Ôºå‰øùÂ≠òÈÅ∏ÊìáÁØÑÂúç
            previewContent.addEventListener('blur', saveSelection);
            previewContent.addEventListener('focus', restoreSelection);
        });

        // ËôïÁêÜÈ†êË¶ΩÈù¢ÊùøÊåâÈçµ‰∫ã‰ª∂
        function handlePreviewKeydown(e) {
            if (e.ctrlKey && e.key === 'z' && !e.shiftKey) {
                e.preventDefault();
                undo();
            } else if (e.ctrlKey && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {
                e.preventDefault();
                redo();
            }
        }

        // ËôïÁêÜÈ†êË¶ΩÈù¢ÊùøËº∏ÂÖ•Ââç‰∫ã‰ª∂
        function handlePreviewBeforeInput(e) {
            if (isPreviewMode && !isUpdatingFromPreview) {
                // Âú®Ëº∏ÂÖ•Ââç‰øùÂ≠òÁï∂ÂâçÁãÄÊÖã
                saveToHistory();
            }
        }

        // ËôïÁêÜËº∏ÂÖ•ËÆäÂåñ
        function handleInputChange() {
            if (isPreviewMode & !isUpdatingFromPreview) {
                updatePreview();
            }
        }

        // ËôïÁêÜÈ†êË¶ΩÈù¢ÊùøÂÖßÂÆπËÆäÂåñ
        function handlePreviewChange(e) {
            if (isPreviewMode && !isUpdatingFromPreview) {
                isUpdatingFromPreview = true;
                
                const previewContent = document.getElementById('previewContent');
                const plainText = getPlainTextFromPreview(previewContent);
                
                document.getElementById('checkerInput').value = plainText;
                
                // Âª∂ÈÅ≤ÈáçÊñ∞ÊáâÁî®È´ò‰∫ÆÔºåÈÅøÂÖçÂÖâÊ®ôË∑≥Âãï
                setTimeout(() => {
                    updatePreviewWithoutCursorReset();
                    isUpdatingFromPreview = false;
                }, 10);
                
                updateCheckerStatus('È†êË¶ΩÂÖßÂÆπÂ∑≤Êõ¥Êñ∞');
            }
        }

        // ÂæûÈ†êË¶ΩÈù¢ÊùøÊèêÂèñÁ¥îÊñáÊú¨
        function getPlainTextFromPreview(element) {
            let text = '';
            for (let node of element.childNodes) {
                if (node.nodeType === Node.TEXT_NODE) {
                    text += node.textContent;
                } else if (node.nodeType === Node.ELEMENT_NODE) {
                    text += getPlainTextFromPreview(node);
                }
            }
            return text;
        }

        // Âú®ÂÖâÊ®ô‰ΩçÁΩÆÊèíÂÖ•ÊñáÊú¨
        function insertTextAtCursor(text) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                const textNode = document.createTextNode(text);
                range.insertNode(textNode);
                range.setStartAfter(textNode);
                range.setEndAfter(textNode);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }

        // ‰øùÂ≠òÈÅ∏ÊìáÁØÑÂúç
        function saveSelection() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                lastSavedSelection = {
                    start: getTextOffset(selection.getRangeAt(0).startContainer, selection.getRangeAt(0).startOffset),
                    end: getTextOffset(selection.getRangeAt(0).endContainer, selection.getRangeAt(0).endOffset)
                };
            }
        }

        // ÊÅ¢Âæ©ÈÅ∏ÊìáÁØÑÂúç
        function restoreSelection() {
            if (lastSavedSelection && isPreviewMode) {
                setTimeout(() => {
                    setTextSelection(lastSavedSelection.start, lastSavedSelection.end);
                }, 10);
            }
        }

        // Áç≤ÂèñÊñáÊú¨ÂÅèÁßªÈáè
        function getTextOffset(node, offset) {
            const previewContent = document.getElementById('previewContent');
            const walker = document.createTreeWalker(
                previewContent,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let textOffset = 0;
            let currentNode;
            
            while (currentNode = walker.nextNode()) {
                if (currentNode === node) {
                    return textOffset + offset;
                }
                textOffset += currentNode.textContent.length;
            }
            
            return textOffset;
        }

        // Ë®≠ÁΩÆÊñáÊú¨ÈÅ∏Êìá
        function setTextSelection(start, end) {
            const previewContent = document.getElementById('previewContent');
            const walker = document.createTreeWalker(
                previewContent,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            const range = document.createRange();
            const selection = window.getSelection();
            let textOffset = 0;
            let startSet = false;
            let currentNode;
            
            while (currentNode = walker.nextNode()) {
                const nodeLength = currentNode.textContent.length;
                
                if (!startSet && textOffset + nodeLength >= start) {
                    range.setStart(currentNode, start - textOffset);
                    startSet = true;
                }
                
                if (startSet && textOffset + nodeLength >= end) {
                    range.setEnd(currentNode, end - textOffset);
                    break;
                }
                
                textOffset += nodeLength;
            }
            
            selection.removeAllRanges();
            selection.addRange(range);
        }

        // ‰øùÂ≠òÂà∞Ê≠∑Âè≤Ë®òÈåÑ
        function saveToHistory() {
            const previewContent = document.getElementById('previewContent');
            const currentText = getPlainTextFromPreview(previewContent);
            
            // ÁßªÈô§Áï∂ÂâçÁ¥¢Âºï‰πãÂæåÁöÑÊ≠∑Âè≤Ë®òÈåÑ
            previewHistory = previewHistory.slice(0, historyIndex + 1);
            
            // Ê∑ªÂä†Êñ∞ÁöÑÊ≠∑Âè≤Ë®òÈåÑ
            previewHistory.push(currentText);
            historyIndex = previewHistory.length - 1;
            
            // ÈôêÂà∂Ê≠∑Âè≤Ë®òÈåÑÊï∏Èáè
            if (previewHistory.length > 25) {
                previewHistory.shift();
                historyIndex--;
            }
        }

        // Êí§Èä∑Êìç‰Ωú
        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                const previousText = previewHistory[historyIndex];
                
                isUpdatingFromPreview = true;
                document.getElementById('checkerInput').value = previousText;
                updatePreview();
                isUpdatingFromPreview = false;
                
                updateCheckerStatus('Â∑≤Êí§Èä∑Êìç‰Ωú');
            }
        }

        // ÈáçÂÅöÊìç‰Ωú
        function redo() {
            if (historyIndex < previewHistory.length - 1) {
                historyIndex++;
                const nextText = previewHistory[historyIndex];
                
                isUpdatingFromPreview = true;
                document.getElementById('checkerInput').value = nextText;
                updatePreview();
                isUpdatingFromPreview = false;
                
                updateCheckerStatus('Â∑≤ÈáçÂÅöÊìç‰Ωú');
            }
        }

        // ÂàáÊèõÈ†êË¶ΩÊ®°Âºè
        function togglePreview() {
            isPreviewMode = !isPreviewMode;
            const toggleBtn = document.getElementById('previewToggle');
            const previewPanel = document.getElementById('previewPanel');
            const checkerOutput = document.getElementById('checkerOutput');
            
            if (isPreviewMode) {
                toggleBtn.classList.add('active');
                previewPanel.classList.add('active');
                checkerOutput.style.display = 'none';
                
                // ÂàùÂßãÂåñÊ≠∑Âè≤Ë®òÈåÑ
                const input = document.getElementById('checkerInput').value;
                previewHistory = [input];
                historyIndex = 0;
                
                updatePreview();
                updateCheckerStatus('Âç≥ÊôÇÈ†êË¶ΩÊ®°ÂºèÂ∑≤ÈñãÂïü - ÂèØÁõ¥Êé•Á∑®ËºØ (Ctrl+ZÊí§Èä∑)');
            } else {
                toggleBtn.classList.remove('active');
                previewPanel.classList.remove('active');
                checkerOutput.style.display = 'block';
                
                // Ê∏ÖÁêÜÊ≠∑Âè≤Ë®òÈåÑ
                previewHistory = [];
                historyIndex = -1;
                lastSavedSelection = null;
                
                updateCheckerStatus('Âç≥ÊôÇÈ†êË¶ΩÊ®°ÂºèÂ∑≤ÈóúÈñâ');
            }
        }

        // Êõ¥Êñ∞Âç≥ÊôÇÈ†êË¶ΩÔºà‰∏çÈáçÁΩÆÂÖâÊ®ôÔºâ
        function updatePreviewWithoutCursorReset() {
            const input = document.getElementById('checkerInput').value;
            const previewContent = document.getElementById('previewContent');
            
            if (!input.trim()) {
                previewContent.innerHTML = 'Ë´ãËº∏ÂÖ•ÊñáÊú¨‰ª•Êü•ÁúãÂç≥ÊôÇÈ†êË¶Ω...';
                return;
            }

            // ‰øùÂ≠òÁï∂ÂâçÈÅ∏Êìá
            saveSelection();

            // ÊáâÁî®È´ò‰∫ÆË¶èÂâá
            let highlightedText = escapeHtml(input);
            
            // 1. ÂÖàÈ´ò‰∫ÆÂÜíËôüÔºå‰ΩøÁî®ÂîØ‰∏ÄÊ®ôË®ò‰øùË≠∑
            highlightedText = highlightedText.replace(
                /([^<>]*?)(:)([^<>]*?)/g,
                '$1{{COLON_PLACEHOLDER}}$3'
            );

            // 2. È´ò‰∫ÆÁ©∫ÁôΩÂ≠óÁ¨¶
            highlightedText = highlightedText.replace(
                /( |\t)/g,
                '<span class="highlight-whitespace">$1</span>'
            );

            // 3. ÈÇÑÂéüÂÜíËôüÈ´ò‰∫Æ
            highlightedText = highlightedText.replace(
                /{{COLON_PLACEHOLDER}}/g,
                '<span class="highlight-colon">:</span>'
            );

            // 3. È´ò‰∫Æ user
            highlightedText = highlightedText.replace(
                /(\buser\b)/ig,
                '<span class="highlight-user">$1</span>'
            );
            
            // 4. È´ò‰∫Æ char
            highlightedText = highlightedText.replace(
                /(\bchar\b)/ig,
                '<span class="highlight-char">$1</span>'
            );

            previewContent.innerHTML = highlightedText;

            // ÊÅ¢Âæ©ÈÅ∏Êìá
            restoreSelection();
        }

        // Êõ¥Êñ∞Âç≥ÊôÇÈ†êË¶Ω
        function updatePreview() {
            const input = document.getElementById('checkerInput').value;
            const previewContent = document.getElementById('previewContent');
            
            if (!input.trim()) {
                previewContent.innerHTML = 'Ë´ãËº∏ÂÖ•ÊñáÊú¨‰ª•Êü•ÁúãÂç≥ÊôÇÈ†êË¶Ω...';
                return;
            }

            // ÊáâÁî®È´ò‰∫ÆË¶èÂâá
            let highlightedText = escapeHtml(input);
            
            // 1. ÂÖàÈ´ò‰∫ÆÂÜíËôüÔºå‰ΩøÁî®ÂîØ‰∏ÄÊ®ôË®ò‰øùË≠∑
            highlightedText = highlightedText.replace(
                /([^<>]*?)(:)([^<>]*?)/g,
                '$1{{COLON_PLACEHOLDER}}$3'
            );
            
            // 2. È´ò‰∫ÆÁ©∫ÁôΩÂ≠óÁ¨¶
            highlightedText = highlightedText.replace(
                /( |\t)/g,
                '<span class="highlight-whitespace">$1</span>'
            );

            // 3. ÈÇÑÂéüÂÜíËôüÈ´ò‰∫Æ
            highlightedText = highlightedText.replace(
                /{{COLON_PLACEHOLDER}}/g,
                '<span class="highlight-colon">:</span>'
            );

            // 3. È´ò‰∫Æ user
            highlightedText = highlightedText.replace(
                /(\buser\b)/ig,
                '<span class="highlight-user">$1</span>'
            );
            
            // 4. È´ò‰∫Æ char
            highlightedText = highlightedText.replace(
                /(\bchar\b)/ig,
                '<span class="highlight-char">$1</span>'
            );

            previewContent.innerHTML = highlightedText;
        }

        // HTML ËΩâÁæ©ÂáΩÊï∏
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Êõ¥Êñ∞Ê™¢Êü•Âô®ÁãÄÊÖãÁöÑÂáΩÊï∏
        function updateCheckerStatus(text) {
            const statusElement = document.getElementById('checkerStatusText');
            if (statusElement) {
                statusElement.textContent = text;
            }
        }

        // ÊñáÊú¨Ê™¢Êü•Âô®ÂäüËÉΩ
        function checkLength() {
            const input = document.getElementById('checkerInput').value;
            const output = document.getElementById('checkerOutput');
            
            if (!input.trim()) {
                alert('Ë´ãÂÖàËº∏ÂÖ•Ë¶ÅÊ™¢Êü•ÁöÑÊñáÊú¨');
                return;
            }
            
            // Â¶ÇÊûúÂú®È†êË¶ΩÊ®°ÂºèÔºåÂÖàÂàáÊèõÂõûÊ≠£Â∏∏Ê®°Âºè
            if (isPreviewMode) {
                togglePreview();
            }
            
            const charCount = input.length;
            const wordCount = input.trim().split(/\s+/).length;
            const lineCount = input.split('\n').length;
            
            output.textContent = `ÊñáÊú¨Èï∑Â∫¶Ê™¢Êü•ÁµêÊûúÔºö
            
Â≠óÁ¨¶Êï∏Ôºö${charCount}
ÂñÆË©ûÊï∏Ôºö${wordCount}
Ë°åÊï∏Ôºö${lineCount}
‰∏çÂê´Á©∫Ê†ºÂ≠óÁ¨¶Êï∏Ôºö${input.replace(/\s/g, '').length}`;
            
            updateCheckerStatus('Èï∑Â∫¶Ê™¢Êü•ÂÆåÊàê');
        }

        function checkSpaces() {
            const input = document.getElementById('checkerInput').value;
            const output = document.getElementById('checkerOutput');
            
            if (!input.trim()) {
                alert('Ë´ãÂÖàËº∏ÂÖ•Ë¶ÅÊ™¢Êü•ÁöÑÊñáÊú¨');
                return;
            }
            
            // Â¶ÇÊûúÂú®È†êË¶ΩÊ®°ÂºèÔºåÂÖàÂàáÊèõÂõûÊ≠£Â∏∏Ê®°Âºè
            if (isPreviewMode) {
                togglePreview();
            }
            
            const spaces = input.match(/ /g) || [];
            const tabs = input.match(/\t/g) || [];
            const newlines = input.match(/\n/g) || [];
            const allWhitespace = input.match(/\s/g) || [];
            
            output.textContent = `Á©∫ÁôΩÂ≠óÁ¨¶Ê™¢Êü•ÁµêÊûúÔºö
            
Á©∫Ê†ºÊï∏Ôºö${spaces.length}
TabÂ≠óÁ¨¶Êï∏Ôºö${tabs.length}
ÊèõË°åÁ¨¶Êï∏Ôºö${newlines.length}
Á∏ΩÁ©∫ÁôΩÂ≠óÁ¨¶Êï∏Ôºö${allWhitespace.length}`;
            
            updateCheckerStatus('Á©∫ÁôΩÂ≠óÁ¨¶Ê™¢Êü•ÂÆåÊàê');
        }

        function copyCheckerResult() {
            let contentToCopy;
            
            if (isPreviewMode) {
                // È†êË¶ΩÊ®°Âºè‰∏ãË§áË£ΩÂéüÂßãÊñáÊú¨
                contentToCopy = document.getElementById('checkerInput').value;
                if (!contentToCopy.trim()) {
                    alert('Ê≤íÊúâÂÖßÂÆπÂèØ‰ª•Ë§áË£Ω');
                    return;
                }
            } else {
                // Ê≠£Â∏∏Ê®°Âºè‰∏ãË§áË£ΩÊ™¢Êü•ÁµêÊûú
                contentToCopy = document.getElementById('checkerOutput').textContent;
                if (!contentToCopy.trim() || contentToCopy.includes('Ë´ãËº∏ÂÖ•ÊñáÊú¨‰∏¶ÈÅ∏ÊìáÊ™¢Êü•È†ÖÁõÆ')) {
                    alert('Ê≤íÊúâÊ™¢Êü•ÁµêÊûúÂèØ‰ª•Ë§áË£Ω');
                    return;
                }
            }

            navigator.clipboard.writeText(contentToCopy).then(() => {
                alert('ÂÖßÂÆπÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ');
                updateCheckerStatus('Â∑≤Ë§áË£ΩÂÖßÂÆπ');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = contentToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('ÂÖßÂÆπÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ');
                updateCheckerStatus('Â∑≤Ë§áË£ΩÂÖßÂÆπ');
            });
        }

        function clearCheckerOutput() {
            if (isPreviewMode) {
                document.getElementById('checkerInput').value = '';
                document.getElementById('previewContent').innerHTML = 'Ë´ãËº∏ÂÖ•ÊñáÊú¨‰ª•Êü•ÁúãÂç≥ÊôÇÈ†êË¶Ω...';
                
                // ÈáçÁΩÆÊ≠∑Âè≤Ë®òÈåÑ
                previewHistory = [''];
                historyIndex = 0;
                lastSavedSelection = null;
                
                updateCheckerStatus('È†êË¶ΩÂÖßÂÆπÂ∑≤Ê∏ÖÁ©∫');
            } else {
                document.getElementById('checkerOutput').textContent = 'Ë´ãËº∏ÂÖ•ÊñáÊú¨‰∏¶ÈÅ∏ÊìáÊ™¢Êü•È†ÖÁõÆ...';
                updateCheckerStatus('Ê™¢Êü•ÁµêÊûúÂ∑≤Ê∏ÖÁ©∫');
            }
        }


             // TokenË®àÊï∏Âô®ÂäüËÉΩ
                function calculateTokens() {
                const input = document.getElementById('tokenInput').value;
                const counter = document.getElementById('tokenCounter');

                if (!input) {
                    counter.textContent = `Token: 0`;
                    updateStatus('Ë´ãËº∏ÂÖ•ÊñáÂ≠ó');
                    return;
                }

                    // Âü∫ÊñºÂØ¶ÈöõÂ∞çÊØîË™øÊï¥ÁöÑ‰øÇÊï∏
                const chineseChars = (input.match(/[\u4e00-\u9fff]/g) || []).length;
                const englishWords = (input.match(/[a-zA-Z]+/g) || []).length;
                const englishChars = (input.match(/[a-zA-Z]+/g) || []).join('').length;
                const numbers = (input.match(/\d+/g) || []).length;
                const symbols = (input.match(/[^\w\s\u4e00-\u9fff]/g) || []).length;
                const spaces = (input.match(/\s+/g) || []).length;

                    
                    // Ë™øÊï¥ÂæåÁöÑ‰øÇÊï∏
                    const estimatedTokens = Math.round(
                        chineseChars * 1 +           // ‰∏≠Êñá
                        englishChars * 0.235 +          // Ëã±Êñá
                        numbers * 0.5 +                // Êï∏Â≠ó
                        symbols * 0.3 +                // Á¨¶Ëôü
                        spaces * 0.1                 // Á©∫Ê†º
                    );

    
                    counter.textContent = `Token: ${estimatedTokens}`;
                    updateStatus(`TokenË®àÁÆóÂÆåÊàêÔºö${estimatedTokens}`);
                }

        // ÂàùÂßãÂåñÁãÄÊÖã
        updateGlobalStatus('È¶ñÈ†Å');
        updateStatus('Á≠âÂæÖÊìç‰Ωú');
        updateCheckerStatus('Á≠âÂæÖÊìç‰Ωú')
    </script>
</body>
</html>